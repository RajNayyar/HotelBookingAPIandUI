<!-- Tab links -->
<html>
<head>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="tab">
  <button class="tablinks" onclick="openCar(event, 'Car')">Cars</button>
  <button class="tablinks" onclick="openHotel(event, 'Hotel')">Hotels</button>
   <button class="tablinks" onclick="openActivity(event, 'Activity')">Activity</button>
  <button class="tablinks" onclick="openFlight(event, 'Flight')">Flights</button>
</div>
<div id = 'tab-list'>
</div>
<p id = "demo"></p>
<!-- Tab content -->


<script>
function openCar(evt, bookingName) {
  ParseJsonAndCreateDivs(bookingName)

}

function openHotel(evt, bookingName) {
   ParseJsonAndCreateDivs(bookingName)
}
function openActivity(evt, bookingName)
{
    ParseJsonAndCreateDivs(bookingName)
}

function openFlight(evt, bookingName)
{
    ParseJsonAndCreateDivs(bookingName)
}


function ParseJsonAndCreateDivs(bookingName)
{
     document.getElementById('tab-list').innerHTML = "";
    var xmlhttp = new XMLHttpRequest();
xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var myArr = JSON.parse(this.responseText);
        if(myArr.length==0)
        {
            alert("No Data Found")
            return
        }
       for(var i=0;i<myArr.length;i++)
        {
           //  document.getElementById("demo").innerHTML = myArr[i].Name + " " + myArr[i].Price ;
           // Your existing code unmodified...
            var iDiv = document.createElement('div');
            iDiv.id = i;
            iDiv.className = 'carList';
            document.getElementById('tab-list').appendChild(iDiv);
             var para = document.createElement("p");
            var node = document.createTextNode("Id: "+myArr[i].Id);
            para.appendChild(node);
            iDiv.appendChild(para);
            var para = document.createElement("p");
            var node = document.createTextNode("Name: "+myArr[i].Name);
            para.appendChild(node);
            iDiv.appendChild(para);
            var para = document.createElement("p");
            var node = document.createTextNode("Price: "+myArr[i].Price);
            para.appendChild(node);
            iDiv.appendChild(para);

            if(bookingName=="Flight")
            {
            var para = document.createElement("p");
            var node = document.createTextNode("Price: "+myArr[i].Source);
            para.appendChild(node);
            iDiv.appendChild(para);
             var para = document.createElement("p");
            var node = document.createTextNode("Price: "+myArr[i].Destination);
            para.appendChild(node);
            iDiv.appendChild(para);
             var para = document.createElement("p");
            var node = document.createTextNode("Price: "+myArr[i].DepartureDate);
            para.appendChild(node);
            iDiv.appendChild(para);
             var para = document.createElement("p");
            var node = document.createTextNode("Price: "+myArr[i].ArrivalDate);
            para.appendChild(node);
            iDiv.appendChild(para);
            var para = document.createElement("p");
            var node = document.createTextNode("Price: "+myArr[i].DepartureTime);
            para.appendChild(node);
            iDiv.appendChild(para);
             var para = document.createElement("p");
            var node = document.createTextNode("Price: "+myArr[i].ArrivalTime);
            para.appendChild(node);
            iDiv.appendChild(para);
            }

           var btn = document.createElement("BUTTON");

            var t;
            if (myArr[i].IsSaved == "1") {
            btn.className = "saved";
            t = document.createTextNode("Saved");
            }
            else {
            btn.className = "save";
            t = document.createTextNode("Save");
            }
            btn.appendChild(t);
            btn.setAttribute('id',i)
            iDiv.appendChild(btn);
            document.getElementById(i).addEventListener("click", function()
            {
            save(this.id, bookingName)
            });
            var btn = document.createElement("BUTTON");
            var t;
            if (myArr[i].IsBooked == "1") {
            btn.className = "booked";
            t = document.createTextNode("Booked");
            }   
            else {
            btn.className = "book";
            t = document.createTextNode("Book");
            }
            btn.appendChild(t);
            btn.setAttribute('id',i)
            iDiv.appendChild(btn);
            document.getElementById(i).addEventListener("click", function() {
                debugger;
            book(this.id, bookingName)

});

            /*var para = document.createElement("p");
            var node = document.createTextNode("IsSaved: "+myArr[i].IsSaved);
            para.appendChild(node);
            iDiv.appendChild(para);
            var para = document.createElement("p");
            var node = document.createTextNode("IsBooked: "+myArr[i].IsBooked);*/

        }
    }
};
xmlhttp.open("GET", "http://localhost:55308/api/"+bookingName, true);
xmlhttp.send();

}


function save(id,product)

{

var xmlhttp = new XMLHttpRequest();

var Arr = document.getElementById(product);

object = {};

object["id"]=id;

object["type"]="Saved";

object = JSON.stringify(object);
console.log(object);
xmlhttp.open("PUT", "http://localhost:55308/api/" + product, true);

xmlhttp.setRequestHeader("Content-Type", "application/json; charset=utf-8");

xmlhttp.send(object);

}

function book(id, product)

{
    debugger;

var xmlhttp = new XMLHttpRequest();

var Arr = document.getElementById(product);

object = {};

object["id"]=id;

object["type"]="Booked";

object = JSON.stringify(object);

xmlhttp.open("PUT", "http://localhost:55308/api/" + product, true);

xmlhttp.setRequestHeader("Content-Type", "application/json; charset=utf-8");

xmlhttp.send(object);

}

</script>
</body> 
</html>